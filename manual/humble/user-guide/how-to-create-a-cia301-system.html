

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to create a cia301 system with ros2_control &mdash; ros2_canopen 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=efd85694" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to create a robot system with ros2_control" href="how-to-create-a-robot-system.html" />
    <link rel="prev" title="How to create a configuration package" href="how-to-create-a-configuration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ros2_canopen
              <img src="../_static/ros2-canopen-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/operation.html">Setup CAN Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/examples.html">Running Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="operation.html">Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html#bus-configuration-file">Bus Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html#configuration-package-cmake">Configuration Package CMake</a></li>
<li class="toctree-l1"><a class="reference internal" href="master.html">Master Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy-driver.html">Proxy Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="cia402-driver.html">Cia402 Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="how-to-create-a-configuration.html">How to create a configuration package</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to create a cia301 system with ros2_control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparing-the-configuration">Preparing the configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-rpdo-to-access-the-current-state">Use RPDO to access the current state</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-tpdo-to-send-commands">Use TPDO to send commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-launch-the-nodes">How to launch the nodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="how-to-create-a-robot-system.html">How to create a robot system with ros2_control</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/design-objectives.html">Design Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/new-driver.html">Creating a new device driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers-guide/new-master.html">Creating a new master</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ros-industrial.github.io/ros2_canopen/api/">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Tests</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software-tests/proxy-driver-test.html">Lifecycle Proxy Driver Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software-tests/proxy-driver-test.html#proxy-driver-test">Proxy Driver Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software-tests/ros2_control_system-test.html">ros2_control SystemInterface test</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application Demos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../application/prbt_robot.html">Pilz manipulator PRBT 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../application/trinamic.html">Trinamic Stepper Motor control</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ros2_canopen</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to create a cia301 system with ros2_control</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user-guide/how-to-create-a-cia301-system.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-create-a-cia301-system-with-ros2-control">
<h1>How to create a cia301 system with ros2_control<a class="headerlink" href="#how-to-create-a-cia301-system-with-ros2-control" title="Link to this heading"></a></h1>
<p>The CiA 301 profile, also known as the CANopen application layer,
is the foundation of the CANopen protocol. It defines the basic principles,
communication services, and object dictionary used for device communication
and network management in a CANopen system.</p>
<p>The CiA 301 profile defines several communication services that allow devices
to exchange data and perform actions. These services include
the SDO (Service Data Object) service for transferring object data between devices,
the PDO (Process Data Object) service for real-time data exchange,
and the NMT (Network Management) service for network initialization,
device state control, and error handling.</p>
<p>To bring up the CiA301 interface using ROS2, it includes three steps:</p>
<ul class="simple">
<li><p>preparing the configuration for bus and <code class="docutils literal notranslate"><span class="pre">ros2_control</span></code></p></li>
<li><p>preparing the state and command interfaces,</p></li>
<li><p>and finally preparing the launch file.</p></li>
</ul>
<section id="preparing-the-configuration">
<h2>Preparing the configuration<a class="headerlink" href="#preparing-the-configuration" title="Link to this heading"></a></h2>
<p>To use the control system interface for CiA301 profile, we should prepare the following</p>
<ul class="simple">
<li><p>bus_conf</p></li>
<li><p>master_dcf</p></li>
<li><p>master_bin</p></li>
<li><p>can_interface, (default: vcan0)</p></li>
</ul>
<p>Define the bus configuration parameters</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">master</span><span class="p">:</span>
<span class="w">    </span><span class="nt">node_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ros2_canopen::MasterDriver&quot;</span>
<span class="w">    </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;canopen_master_driver&quot;</span>
<span class="w">    </span><span class="nt">baudrate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">250</span>
<span class="nt">options</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dcf_path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@BUS_CONFIG_PATH@&quot;</span>
<span class="nt">joint_1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">node_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x00</span>
<span class="w">    </span><span class="nt">dcf</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;joint.eds&quot;</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ros2_canopen::ProxyDriver&quot;</span>
<span class="w">    </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;canopen_proxy_driver&quot;</span>
<span class="w">    </span><span class="nt">reset_communication</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">joint_2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">node_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x01</span>
<span class="w">    </span><span class="nt">dcf</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;joint.eds&quot;</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ros2_canopen::ProxyDriver&quot;</span>
<span class="w">    </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;canopen_proxy_driver&quot;</span>
<span class="w">    </span><span class="nt">reset_communication</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<p>Define the <code class="docutils literal notranslate"><span class="pre">ros2_control</span></code> parameters</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">controller_manager</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">        </span><span class="nt">update_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w">  </span><span class="c1"># Hz</span>

<span class="w">        </span><span class="nt">joint_state_broadcaster</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint_state_broadcaster/JointStateBroadcaster</span>

<span class="w">        </span><span class="nt">joint_1_controller</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopen_ros2_controllers/CanopenProxyController</span>

<span class="w">        </span><span class="nt">joint_2_controller</span><span class="p">:</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopen_ros2_controllers/CanopenProxyController</span>

<span class="w">    </span><span class="nt">joint_1_controller</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">            </span><span class="nt">joint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint_1</span>


<span class="w w-Error">   </span><span class="nt">joint_2_controller</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">            </span><span class="nt">joint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint_2</span>
</pre></div>
</div>
<p>The example of master_dcf see <a class="reference external" href="https://github.com/ros-industrial/ros2_canopen/blob/master/canopen_tests/config/simple/simple.eds">https://github.com/ros-industrial/ros2_canopen/blob/master/canopen_tests/config/simple/simple.eds</a></p>
</section>
<section id="use-rpdo-to-access-the-current-state">
<h2>Use RPDO to access the current state<a class="headerlink" href="#use-rpdo-to-access-the-current-state" title="Link to this heading"></a></h2>
<dl>
<dt>Defining the Joint and CANopen Data Structure</dt><dd><p>The first step is to define a structure that will hold information about your joints and the associated CANopen data. This structure serves as the foundation for  your CANopen network, ensuring that all the relevant data is stored and accessible when needed.</p>
</dd>
<dt>PDO Index and Subindex</dt><dd><p>Each Process Data Object (PDO) has an index and a subindex. The index acts as a unique identifier for each PDO, differentiating it from other PDOs in the system. The subindex is used to access individual data fields within each PDO as a PDO can contain multiple data fields.</p>
</dd>
<dt>Network Management (NMT)</dt><dd><p>Network Management (NMT) is a fundamental service in the CANopen protocol suite. It offers basic device control commands such as start, stop, and reset, and manages the state of devices within the network.</p>
<p>For RPDOs, the data are defined using:</p>
<ul class="simple">
<li><p>“rpdo/index”</p></li>
<li><p>“rpdo/subindex”</p></li>
<li><p>“rpdo/type”</p></li>
<li><p>“rpdo/data”</p></li>
</ul>
<p>For NMT, we can read the states via:</p>
<ul class="simple">
<li><p>“nmt/state”</p></li>
</ul>
</dd>
</dl>
</section>
<section id="use-tpdo-to-send-commands">
<h2>Use TPDO to send commands<a class="headerlink" href="#use-tpdo-to-send-commands" title="Link to this heading"></a></h2>
<p>In order to send commands to hardware devices in a CANopen network, we first need to export the appropriate hardware interfaces. This is a critical step that enables us to effectively control each joint within our network.</p>
<dl class="simple">
<dt>Registering Transmit Process Data Objects (TPDOs)</dt><dd><p>Similar to how we handle state interfaces, we must register Transmit Process Data Objects (TPDOs) for each joint. These TPDOs are related to the following commands:</p>
</dd>
</dl>
<ul class="simple">
<li><p>“tpdo/index”</p></li>
<li><p>“tpdo/subindex”</p></li>
<li><p>“tpdo/type”</p></li>
<li><p>“tpdo/data”</p></li>
<li><p>“tpdo/owns”</p></li>
</ul>
<dl class="simple">
<dt>Network Management (NMT) Commands</dt><dd><p>Beyond this, we have the ability to register commands associated with Network Management (NMT) to control the state of devices within our network. This is important for the smooth operation and control of our devices. The NMT related commands include:</p>
</dd>
</dl>
<ul class="simple">
<li><p>“nmt/reset”</p></li>
<li><p>“nmt/reset_fbk”</p></li>
<li><p>“nmt/start”</p></li>
<li><p>“nmt/start_fbk”</p></li>
</ul>
<p>These NMT commands not only help in managing the state of devices but also in providing feedback (indicated by “fbk”) from the device to the control system after the execution of a command. This feedback mechanism is crucial for ensuring the successful execution of commands and managing the overall health of the network.</p>
</section>
<section id="how-to-launch-the-nodes">
<h2>How to launch the nodes<a class="headerlink" href="#how-to-launch-the-nodes" title="Link to this heading"></a></h2>
<p>Finally, we prepare the launch file for the interface. For reference, here’s an example launch file from the ROS2 Iron distribution: <a class="reference external" href="https://github.com/ros-industrial/ros2_canopen/blob/iron/canopen_ros2_control/launch/canopen_system.launch.py">https://github.com/ros-industrial/ros2_canopen/blob/iron/canopen_ros2_control/launch/canopen_system.launch.py</a></p>
<p>For testing, please refer to following section.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="how-to-create-a-configuration.html" class="btn btn-neutral float-left" title="How to create a configuration package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="how-to-create-a-robot-system.html" class="btn btn-neutral float-right" title="How to create a robot system with ros2_control" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Christoph Hellmann Santos,  Harshavardhan Deshpande.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>